## Comparison of a GPU and a MIMD With Multimedia SIMD

> ## GPU 和 MIMD 与 Multimedia Simd 的比较

A group of Intel researchers published a paper ([Lee et al., 2010](#_bookmark976)) comparing a quad- core Intel i7 with multimedia SIMD extensions to the Tesla GTX 280. Although the study did not compare the latest versions of CPUs and GPUs, it was the most in-depth comparison of the two styles in that it explained the reasons behind the differences in performance. Moreover, the current versions of these architectures share many similarities to the ones in the study.

> 一群英特尔研究人员发表了一篇论文（[Lee 等，2010]（#_ bookmark976））将四核 Intel I7 与 Tesla GTX 280 进行了比较的 Quad-Core Intel I7 与 Tesla GTX 280.和 GPU，这是两种样式的最深入的比较，因为它解释了性能差异背后的原因。此外，这些架构的当前版本与研究中的版本具有许多相似之处。

Figure 4.27 Intel Core i7-960 and NVIDIA GTX 280. The rightmost column shows the ratios of GTX 280 to Core i7. For single-precision SIMD FLOPS on the GTX 280, the higher speed (933) comes from a very rare case of dual issuing of fused multiply-add and multiply. More reasonable is 622 for single fused multiply-adds. Note that these memory bandwidths are higher than in [Figure 4.28](#_bookmark201) because these are DRAM pin bandwidths and those in [Figure 4.28](#_bookmark201) are at the processors as measured by a benchmark program. From Table 2 in Lee, W.V., et al., 2010. Debunking the 100 GPU vs. CPU myth: an evaluation of throughput computing on CPU and GPU. In: Proc. 37th Annual Int’l. Sym- posium on Computer Architecture (ISCA), June 19–23, 2010, Saint-Malo, France.

> 图 4.27 Intel Core i7-960 和 NvidiaGTX280。最右边的列显示了 GTX 280 与 Core i7 的比率。对于 GTX 280 上的单位 SIMD 拖鞋，较高的速度（933）来自非常罕见的双重发行熔融倍数添加和乘数的情况。更合理的是单一熔融倍数添加的 622。请注意，这些内存带宽高于[图 4.28]（#_ bookmark2201）中的记忆带宽，因为这些是 DRAM PIN 带宽，并且[图 4.28]（#_kbookmark201）中的记忆带宽在处理器上通过基准程序测量。摘自 Lee，W.V。等，2010 的表 2。揭穿 100 GPU 与 CPU 神话：CPU 和 GPU 上吞吐量计算的评估。在：Proc。第 37 届年度 Int’l。2010 年 6 月 19 日至 23 日，法国圣马洛，计算机建筑（ISCA）的符号（ISCA）。

[Figure 4.27](#_bookmark200) lists the characteristics of the two systems. Both products were pur- chased in the fall of 2009. The Core i7 is in Intel’s 45-nanometer semiconductor technology, while the GPU is in TSMC’s 65-nanometer technology. Although it might have been fairer to have a comparison done by a neutral party or by both interested parties, the purpose of this section is _not_ to determine how much faster one product is than the other, but to try to understand the relative value of features of these two contrasting architecture styles.

> [图 4.27]（#_ bookmark200）列出了两个系统的特征。这两种产品均在 2009 年秋季进行。核心 i7 在英特尔的 45 纳米半导体技术中，而 GPU 则使用 TSMC 的 65 纳米技术。尽管进行中立政党或双方进行比较可能更公平，但本节的目的是_not_确定一种产品比另一种产品快，但要尝试了解功能的相对价值在这两种对比的建筑风格中。

The rooflines of the Core i7 920 and GTX 280 in [Figure 4.28](#_bookmark201) illustrate the dif- ferences in the computers. The 920 has a slower clock rate than the 960 (2.66 GHz vs. 3.2 GHz), but the rest of the system is the same. Not only does the GTX 280 have much higher memory bandwidth and double-precision floating-point perfor- mance, but also its double-precision ridge point is considerably to the left. As pre- viously mentioned, it is much easier to hit peak computational performance the further the ridge point of the roofline is to the left. The double-precision ridge point is 0.6 for the GTX 280 versus 2.6 for the Core i7. For single-precision performance, the ridge point moves far to the right, as it’s considerably harder to hit the roof of single-precision performance because it is so much higher. Note that the arithmetic intensity of the kernel is based on the bytes that go to main memory, not the bytes that go to cache memory. Thus caching can change the arithmetic intensity of a kernel on a particular computer, presuming that most references really go to the cache. The Rooflines help explain the relative performance in this case study. Note also that this bandwidth is for unit-stride accesses in both architectures. Real gather-scatter addresses that are not coalesced are slower on the GTX 280 and on the Core i7, as we will see.

> [图 4.28]（#_ bookmark201）中核心 i7 920 和 GTX 280 的屋顶线说明了计算机中的差异。920 的时钟速率比 960（2.66 GHz vs. 3.2 GHz）慢，但是系统的其余部分是相同的。GTX 280 不仅具有更高的内存带宽和双精度的浮点穿孔，而且其双精度山脊点在左边也相当大。正如预先提到的那样，达到峰值计算性能要容易得多，屋顶线的山脊点越多。GTX 280 的双精度脊点为 0.6，而 Core i7 的脊速为 2.6。对于单精度的性能，山脊点向右移动，因为它很难击中单精度性能的屋顶，因为它要高得多。请注意，内核的算术强度基于转到主内存的字节，而不是用于缓存内存的字节。因此，缓存可以改变特定计算机上内核的算术强度，从而假定大多数引用真正用于缓存。屋顶线有助于解释该案例研究中的相对表现。还要注意，此带宽适用于两个架构中的单元式访问。正如我们将看到的，在 GTX 280 和核心 i7 上，没有合并的真正聚集奖励的地址较慢。

Figure 4.28 Roofline model ([Williams et al. 2009](#_bookmark1017)). These rooflines show double-precision floating-point perfor- mance in the top row and single-precision performance in the bottom row. (The DP FP performance ceiling is also in the bottom row to give perspective.) The Core i7 920 on the left has a peak DP FP performance of 42.66 GFLOP/s, a SP FP peak of 85.33 GFLOP/s, and a peak memory bandwidth of 16.4 GB/s. The NVIDIA GTX 280 has a DP FP peak of 78 GFLOP/s, SP FP peak of 624 GFLOP/s, and 127 GB/s of memory bandwidth. The dashed vertical line on the left represents an arithmetic intensity of 0.5 FLOP/byte. It is limited by memory bandwidth to no more than 8 DP GFLOP/s or 8 SP GFLOP/s on the Core i7. The dashed vertical line to the right has an arithmetic intensity of 4 FLOP/byte. It is limited only computationally to 42.66 DP GFLOP/s and 64 SP GFLOP/s on the Core i7 and to 78 DP GFLOP/s and 512 DP GFLOP/s on the GTX 280. To hit the highest computation rate on the Core i7, you need to use all 4 cores and SSE instructions with an equal number of multiplies and adds. For the GTX 280, you need to use fused multiply-add instructions on all multithreaded SIMD Processors.

> 图 4.28 车顶线模型（[Williams 等，2009]（#_ Bookmark1017））。这些屋顶线在顶行中显示了双精度的浮点孔，并且在底行中表现出单精度性能。（DP FP 性能上限也处于底部的透视上。）左侧的 Core i7 920 的峰值 DP FP 性能为 42.66 GFLOP/s，SP FP 峰为 85.33 GFLOP/S，峰值内存和峰值内存带宽 16.4 GB/s。NVIDIA GTX 280 的 DP FP 峰为 78 GFLOP/S，SP FP 峰为 624 GFLOP/s 和 127 GB/s 的内存带宽。左侧的虚线垂直线表示算术强度为 0.5 flop/byte。它受内存带宽的限制至核心 i7 上的 8 dp gflop/s 或 8 sp gflop/s。右侧的虚线垂直线的算术强度为 4 flop/byte。它仅在计算上限制为 42.66 dp gflop/s 和核心 i7 上的 64 sp gflop/s，而 GTX 280 上的核心 i7 和 78 dp gflop/s 和 512 dp gflop/s。您需要使用所有 4 个内核和 SSE 指令，并使用相等数量的乘积和添加。对于 GTX 280，您需要在所有多线程 SIMD 处理器上使用融合的乘数指令。

The researchers said that they selected the benchmark programs by analyzing the computational and memory characteristics of four recently proposed bench- mark suites and then “formulated the set of _throughput computing kernels_ that cap- ture these characteristics.” [Figure 4.29](#_bookmark202) describes these 14 kernels, and [Figure 4.30](#_bookmark203) shows the performance results, with larger numbers meaning faster.

> 研究人员说，他们通过分析最近提出的四个基准套件的计算和记忆特性选择了基准程序，然后“制定了_thoughput 计算内核的集合，从而构成了这些特征”。[图 4.29]（#_ bookmark202）描述了这 14 个内核，[图 4.30]（#_ bookmark203）显示了性能结果，数字较大的含义更快。

Given that the raw performance specifications of the GTX 280 vary from 2.5 slower (clock rate) to 7.5 faster (cores per chip) while the performance varies from 2.0 slower (Solv) to 15.2 faster (GJK), the Intel researchers explored the reasons for the differences:

> 鉴于 GTX 280 的原始性能规格从慢 2.5（时钟速率）到 7.5 速度（每芯片内核），而性能从 2.0 慢（solv）到 15.2 速度（GJK）不等，英特尔研究人员探索了探索的原因差异：

- _Memory bandwidth_. The GPU has 4.4 the memory bandwidth, which helps explain why LBM and SAXPY run 5.0 and 5.3 faster; their working sets are hundreds of megabytes and thus don’t fit into the Core i7 cache. (To access memory intensively, they did not use cache blocking on SAXPY.) Thus the slope of the rooflines explains their performance. SpMV also has a large work- ing set, but it only runs 1.9 × because the double-precision floating point of the GTX 280 is just 1.5 × faster than the Core i7.

> -_Memory 带宽_。GPU 具有 4.4 内存带宽，这有助于解释为什么 LBM 和 Saxpy 运行 5.0 和 5.3 速度；他们的工作组是数百个兆字节，因此不适合核心 i7 缓存。（要密集地访问内存，他们没有在 Saxpy 上使用缓存阻塞。）因此，屋顶线的斜率解释了它们的性能。SPMV 还具有较大的工作集，但仅运行 1.9 倍，因为 GTX 280 的双精度浮点比 Core i7 快 1.5 倍。

- _Compute bandwidth_. Five of the remaining kernels are compute bound: SGEMM, Conv, FFT, MC, and Bilat. The GTX is faster by 3.9, 2.8, 3.0, 1.8, and 5.7, respectively. The first three of these use single-precision floating-point arithmetic, and GTX 280 single-precision is 3–6 faster. (The 9 faster than the Core i7 as shown in [Figure 4.27](#_bookmark200) occurs only in the very special case when the GTX 280 can issue a fused multiply-add and a multiply per clock cycle.) MC uses double-precision, which explains why it’s just 1.8 faster since DP performance is only 1.5 faster. Bilat uses transcendental func- tions, which the GTX 280 supports directly (see [Figure 4.17](#_bookmark187)). The Core i7 spends two-thirds of its time calculating transcendental functions, so the GTX 280 is 5.7 faster. This observation helps point out the value of hardware support for operations that occur in your workload: double-precision floating- point and perhaps even transcendentals.

> - _ compute 带宽_。其余的五个内核是计算结合的：SGEMM，Conv，FFT，MC 和 Bilat。GTX 的速度分别为 3.9、2.8、3.0、1.8 和 5.7。其中的前三个使用单精确的浮点算术算术，而 GTX 280 单精量速度快 3-6。（如[图 4.27]（#_ bookmark200）所示，比核心 i7 快 9 个，仅在 GTX 280 可以发出融合的乘数和每个时钟周期的倍数时才出现在非常特殊的情况下。，这解释了为什么 DP 性能快 1.5，为什么它快 1.8。BILAT 使用先验功能，GTX 280 直接支持该功能（请参见[图 4.17]（#_ bookmark187））。核心 i7 花费了三分之二的时间来计算先验功能，因此 GTX 280 的速度快 5.7。该观察结果有助于指出硬件支持对工作负载中发生的操作的价值：双精度浮动点甚至超越。

- _Cache benefits_. Ray casting (RC) is only 1.6 faster on the GTX because cache blocking with the Core i7 caches prevents it from becoming memory bandwidth bound, as it is on GPUs. Cache blocking can help Search, too. If the index trees are small so that they fit into the cache, the Core i7 is twice as fast. Larger index trees make them memory bandwidth bound. Overall, the GTX 280 runs Search 1.8 faster. Cache blocking also helps Sort. While most programmers wouldn’t run Sort on a SIMD Processor, it can be written with a 1-bit Sort primitive called _split_. However, the split algorithm executes many more instructions than a scalar sort does. As a result, the GTX 280 runs only 0.8 as fast as the Core i7. Note that caches also help other kernels on the Core i7 because cache blocking allows SGEMM, FFT, and SpMV to become

> - _ cache 好处_。射线铸造（RC）在 GTX 上的速度仅为 1.6，因为用核心 i7 缓存阻止的缓存阻止它阻止其成为内存带宽绑定，因为它在 GPU 上。缓存阻塞也可以帮助搜索。如果索引树很小，以使其适合缓存，则核心 i7 的速度是两倍。较大的索引树使它们使它们的内存带宽绑定。总体而言，GTX 280 运行搜索速度 1.8 速度。缓存阻塞也有助于排序。虽然大多数程序员不会在 SIMD 处理器上运行排序，但可以用 1 位排序原始词_split_编写。但是，拆分算法比标量排序执行更多的说明。结果，GTX 280 的运行速度仅为 Core i7 的 0.8。请注意，缓存还可以帮助核心 i7 上的其他内核，因为缓存阻塞允许 SGEMM，FFT 和 SPMV 成为

Figure 4.29 Throughput computing kernel characteristics. The name in parentheses identifies the benchmark name in this section. The authors suggest that code for both machines had equal optimization effort. From Table 1 in Lee, W.V., et al., 2010. Debunking the 100 GPU vs. CPU myth: an evaluation of throughput computing on CPU and GPU. In: Proc. 37th Annual Int’l. Symposium on Computer Architecture (ISCA), June 19–23, 2010, Saint- Malo, France.

> 图 4.29 吞吐量计算内核特性。括号中的名称标识了本节中的基准名称。作者建议，这两台机器的代码都具有同等的优化工作。摘自 Lee，W.V。等，2010 的表 1。揭穿 100 GPU 与 CPU 神话：CPU 和 GPU 上吞吐量计算的评估。在：Proc。第 37 届年度 Int’l。计算机建筑研讨会（ISCA），2010 年 6 月 19 日至 23 日，法国圣马洛。

Figure 4.30 Raw and relative performance measured for the two platforms. In this study, SAXPY is used only as a measure of memory bandwidth, so the right unit is GB/s and not GFLOP/s. Based on Table 3 in Lee, W.V., et al., 2010. Debunking the 100 GPUthroughput computing on CPU and GPU. In: Proc. 37th Annual Int’l. Symposium on Computer Architecture (ISCA), June 19–23, 2010, Saint-Malo, France.

> 图 4.30 针对两个平台测量的原始和相对性能。在这项研究中，Saxpy 仅用作记忆带宽的量度，因此正确的单元为 GB/S，而不是 GFLOP/S。基于 Lee，W.V。等，2010 年的表 3。揭穿 CPU 和 GPU 上的 100 GPuthroughput 计算。在：Proc。第 37 届年度 Int’l。计算机建筑研讨会（ISCA），2010 年 6 月 19 日至 23 日，法国圣马洛。

compute bound. This observation reemphasizes the importance of cache blocking optimizations in [Chapter 2](#_bookmark46).

> 计算绑定。这种观察重点强调了[第 2 章]（#_ bookmark46）中缓存阻止优化的重要性。

_Gather-Scatter_. The multimedia SIMD extensions are of little help if the data are scattered throughout main memory; optimal performance comes only when data are aligned on 16-byte boundaries. Thus GJK gets little benefit from SIMD on the Core i7. As previously mentioned, GPUs offer gather-scatter addressing that is found in a vector architecture but omitted from SIMD extensions. The Address Coalescing Unit helps as well by combining accesses to the same DRAM line, thereby reducing the number of gathers and scatters. The memory controller also batches together accesses to the identical DRAM page. This combination means the GTX 280 runs GJK a startling 15.2 faster than the Core i7, which is larger than any single physical parameter in [Figure 4.27](#_bookmark200). This observation reinforces the importance of gather-scatter to vector and GPU architectures that is missing from SIMD extensions.

> _gather-scatter_。如果数据散布在主内存中，多媒体 SIMD 扩展几乎没有帮助。最佳性能只有在 16 字节边界对齐数据时才会出现。因此，GJK 从 Core i7 上的 SIMD 受益不大。如前所述，GPU 提供了在向量体系结构中找到的收集筛分，但被 SIMD 扩展省略了。地址合并单元也通过结合对同一 DRAM 线路的访问，从而减少收集器和散射的数量，也有所帮助。内存控制器还批量访问了相同的 DRAM 页面。这种组合意味着 GTX 280 的 gjk 速度比核心 i7 快 15.2，它比[图 4.27]中的任何单个物理参数都要大（#_ bookmark200）。这种观察增强了聚集 - 散布对 simd 扩展中缺少的向量和 GPU 体系结构的重要性。

_Synchronization_. The performance synchronization of Hist is limited by atomic updates, which are responsible for 28% of the total runtime on the Core i7 despite its having a hardware fetch-and-increment instruction. Thus Hist is only 1.7 faster on the GTX 280. Solv solves a batch of independent constraints in a small amount of computation followed by barrier synchronization. The Core i7 benefits from the atomic instructions and a memory consistency model that ensures the right results even if not all previous accesses to memory hierarchy have completed. Without the memory consistency model, the GTX 280 version launches some batches from the system processor, which leads to the GTX 280 running 0.5 as fast as the Core i7. This observation points out how synchronization performance can be important for some data parallel problems.

> _synchronization_。Hist 的性能同步受原子更新的限制，尽管该更新具有硬件提取和提示指令，但该原子更新占 Core i7 总运行时的 28％。因此，HIST 在 GTX 280 上的速度仅 1.7。SOLV 以少量计算后，然后进行屏障同步解决了一批独立的约束。核心 i7 受益于原子指令和内存一致性模型，该模型即使并非所有先前对内存层次结构的访问都已完成，也可以确保正确的结果。没有内存一致性模型，GTX 280 版本将从系统处理器发射一些批次，从而导致 GTX 280 与 Core i7 一样快地运行 0.5。该观察结果指出了同步性能对于某些数据并行问题如何很重要。

It was interesting that the gather-scatter support of vector architectures, which predate the SIMD instructions by decades, was so important to the effective usefulness of these SIMD extensions, which some had predicted before the comparison ([Gebis](#_bookmark950) [and Patterson, 2007](#_bookmark950)). The Intel researchers noted that 6 of the 14 kernels would exploit SIMD better with more efficient gather-scatter support on the Core i7.

> 有趣的是，矢量体系结构的聚集奖励支持几十年来，该载体架构对这些 SIMD 扩展的有效实用性至关重要，有些人在比较之前已经预测了这些扩展（[gebis]（#_ bookmark950）[和 Patterson，2007 年]（#_ bookmark950））。英特尔研究人员指出，在 14 个内核中，有 6 个可以更好地利用 SIMD，并在核心 i7 上获得更有效的聚会奖。

Note that an important feature missing from this comparison was describing the level of effort to get the results for the two systems. Ideally, future comparisons would release the code used on both systems so that others could re-create the same experiments on different hardware platforms and possibly improve on the results.

> 请注意，此比较中缺少一个重要的功能，描述了为获得两个系统的结果的努力。理想情况下，将来的比较将释放两个系统上使用的代码，以便其他人可以在不同的硬件平台上重新创建相同的实验，并可能改善结果。
